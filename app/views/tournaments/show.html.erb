<p><%= raw t '.games_to_process_on', :count => @pending.count, :time => time_tag((Time.zone.now + 1.week).beginning_of_week) %></p>

<table class="table table-bordered table-condensed">
  <thead>
    <tr>
      <th><%= t '.rank' %></th>
      <th><%= User.model_name.human %></th>
      <th><%= Glicko2Rating.model_name.human %></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @rating_ranks.each_with_index do |(rank, ratings), index| %>
      <% ratings.each do |rating| %>
        <tr>
          <% if rating == ratings.first %>
            <td rowspan="<%= ratings.length %>"><%= index + 1 %></td>
          <% end %>
          <td><%= profile_link_tag rating.user %></td>
          <td><%= rank %></td>
          <td>
            <% if rating.user != current_user && @tournament.has_user?(current_user) %>
              <div class="btn-group">
                <%= link_to t(Challenge.model_name.human), new_challenge_path(:defender_id => rating.user, :tournament_id => @tournament), :class => rating.challenge.present? ? 'btn disabled' : 'btn' %>
                <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                  <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                  <li><%= link_to t('.log_a_game'), new_game_path(:tournament_id => @tournament, :user_id => rating.user) %></li>
                </ul>
              </div>
            <% end %>
          </td>
        </tr>
      <% end %>
    <% end %>
    <% if @tournament.glicko2_ratings.empty? %>
      <tr colspan="3">
        <td><%= t '.no_rated_players' %></td>
      </tr>
    <% end %>
  </tbody>
</table>
