<% content_for :title do %><%= @tournament ? @tournament.name : Tournament.model_name.human.pluralize %> - <%= t 'application.name' %><% end %>
<div class="page-header">
  <h1><%= @tournament.name %></h1>
</div>

<ul class="nav nav-pills">
  <% if @tournament.has_user? current_user %>
    <li><%= link_to t('invites.new.title'), new_tournament_invite_path(@tournament), :rel => 'tooltip', :title => t('invites.new.invites_left', :count => @tournament.invites.where(:owner_id => current_user).limit_left) %></li>
  <% else %>
    <li><%= link_to t('.join'), join_tournament_path(@tournament), :method => :post %></li>
  <% end %>
</ul>

<p><%= raw t '.games_to_process_on', :count => @pending.count, :time => time_tag((Time.zone.now + 1.week).beginning_of_week) %></p>

<% if @challenges.any? %>
  <h2><%= Challenge.model_name.human.pluralize %></h2>
  <% @challenges.each do |challenge| %>
    <p><%= link_to "#{challenge.challenger.name} vs #{challenge.defender.name}", challenge_path(challenge) %>, expires in <%= distance_of_time_in_words challenge.processed_at , Time.zone.now %></p>
  <% end %>
<% end %>

<h2><%= t '.ladder' %></h2>
<table class="table table-bordered table-condensed">
  <thead>
    <tr>
      <th><%= t '.rank' %></th>
      <th><%= User.model_name.human %></th>
      <th><%= Glicko2Rating.model_name.human %></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @rating_ranks.each_with_index do |(_, ratings), index| %>
      <% ratings.each do |rating| %>
        <tr>
          <% if rating == ratings.first %>
            <td rowspan="<%= ratings.length %>"><%= index + 1 %></td>
          <% end %>
          <td><%= profile_link_tag rating.user %></td>
          <td><%= number_with_precision rating.low_rank, :precision => 0 %></td>
          <td>
            <% if rating.user != current_user && @tournament.has_user?(current_user) %>
              <div class="btn-group">
                <%= link_to t(Challenge.model_name.human), new_challenge_path(:defender_id => rating.user, :tournament_id => @tournament), :class => 'btn' %>
                <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                  <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                  <li><%= link_to t('.log_a_game'), new_game_path(:tournament_id => @tournament, :user_id => rating.user) %></li>
                </ul>
              </div>
            <% end %>
          </td>
        </tr>
      <% end %>
    <% end %>
    <% if @tournament.glicko2_ratings.empty? %>
      <tr colspan="3">
        <td><%= t '.no_rated_players' %></td>
      </tr>
    <% end %>
  </tbody>
</table>
